editors:
  - version: af24429dcc98
projects:
  - name: Core
    folder: none
    packagename: com.unity.render-pipelines.core
  - name: VFXMain
    folder: VisualEffectGraph
    packagename: com.unity.visualeffectgraph
  - name: ShaderGraph
    folder: ShaderGraph
    packagename: com.unity.shadergraph
  - name: LWRP
    folder: LWGraphicsTest
    packagename: com.unity.render-pipelines.lightweight
  - name: HDRP
    folder: HDRP_Tests
    packagename: com.unity.render-pipelines.high-definition
---

pack_core_package:
  name: z_(do not use) Pack core
  agent:
    type: Unity::VM
    image: package-ci/win10:stable
    flavor: m1.xlarge
  commands:
    - npm install upm-ci-utils@stable -g --registry https://api.bintray.com/npm/unity/unity-npm
    - upm-ci package pack --package-path com.unity.render-pipelines.core
  artifacts:
    packages:
      paths:
      - "upm-ci~/packages/**/*"

{% for editor in editors %}
test_core_package_{{ editor.version }}:
  name: z_(do not use) Test core
  agent:
    type: Unity::VM
    image: package-ci/win10:stable
    flavor: m1.xlarge
  commands:
    - npm install upm-ci-utils@stable -g --registry https://api.bintray.com/npm/unity/unity-npm
    - upm-ci package test -u {{ editor.version }} --package-path com.unity.render-pipelines.core
  artifacts:
    logs:
      paths:
      - "**/upm-ci~/test-results/**/*"
  dependencies:
    - .yamato/upm-ci-packages.yml#pack_core_package
{% endfor %}

pack_shadergraph_package:
  name: z_(do not use) Pack shadergraph
  agent:
    type: Unity::VM
    image: package-ci/win10:stable
    flavor: m1.xlarge
  commands:
    - npm install upm-ci-utils@stable -g --registry https://api.bintray.com/npm/unity/unity-npm
    - upm-ci package pack --package-path com.unity.shadergraph
  artifacts:
    packages:
      paths:
      - "upm-ci~/packages/**/*"

{% for editor in editors %}
test_shadergraph_package_{{ editor.version }}:
  name: z_(do not use) Test shadergraph
  agent:
    type: Unity::VM
    image: package-ci/win10:stable
    flavor: m1.xlarge
  commands:
    - dir
    - dir .\\upm-ci~
    - dir .\\upm-ci~\\packages
    - npm install upm-ci-utils@stable -g --registry https://api.bintray.com/npm/unity/unity-npm
    - pip install unity-downloader-cli --extra-index-url https://artifactory.eu-cph-1.unityops.net/api/pypi/common-python/simple
    - unity-downloader-cli -b {{ editor.version }} -c editor --wait --published
    - mv .\\upm-ci~\\packages\\*.tgz .\\.Editor\\data\\Resources
    - upm-ci package test -u ./.Editor --package-path com.unity.shadergraph
  dependencies:
    - .yamato/upm-ci-packages.yml#pack_core_package
    - .yamato/upm-ci-packages.yml#pack_shadergraph_package
  artifacts:
    logs:
      paths:
      - "upm-ci~/test-results/**/*"
{% endfor %}

# lightweight_package:
#   name: z_(do not use) Pack and Test lightweight
#   agent:
#     type: Unity::VM::osx
#     image: buildfarm/mac:stable
#     flavor: m1.mac
#   commands:
#   {% for editor in editors %}
#   - npm install git+ssh://git@gitlab.cds.internal.unity3d.com:upm-packages/project-templates/upm-template-utils.git#performance-package -g --no-progress
#   - cd com.unity.render-pipelines.lightweight && upm-ci package pack
#   - cd com.unity.render-pipelines.lightweight && upm-ci package test -u {{ editor.version }}
#   {% endfor %}
#   dependencies:
#   - .yamato/upm-ci-packages.yml#core_package
#   - .yamato/upm-ci-packages.yml#shadergraph_package
#   artifacts:
#     logs.zip:
#       paths:
#       - "**/upm-ci~/test-results/**/*"
#       - "**/upm-ci~/packages/**/*.tgz"

# hdrp_package:
#   name: z_(do not use) Pack and Test hdrp
#   agent:
#     type: Unity::VM::osx
#     image: buildfarm/mac:stable
#     flavor: m1.mac
#   commands:
#   {% for editor in editors %}
#   - npm install git+ssh://git@gitlab.cds.internal.unity3d.com:upm-packages/project-templates/upm-template-utils.git#performance-package -g --no-progress
#   - cd com.unity.render-pipelines.high-definition && upm-ci package pack
#   - cd com.unity.render-pipelines.high-definition && upm-ci package test -u {{ editor.version }}
#   {% endfor %}
#   dependencies:
#   - .yamato/upm-ci-packages.yml#core_package
#   - .yamato/upm-ci-packages.yml#shadergraph_package
#   artifacts:
#     logs.zip:
#       paths:
#       - "**/upm-ci~/test-results/**/*"
#       - "**/upm-ci~/packages/**/*.tgz"
      
# vfx_package:
#   name: z_(do not use) Pack and Test vfx
#   agent:
#     type: Unity::VM::osx
#     image: buildfarm/mac:stable
#     flavor: m1.mac
#   commands:
#   {% for editor in editors %}
#   - npm install git+ssh://git@gitlab.cds.internal.unity3d.com:upm-packages/project-templates/upm-template-utils.git#performance-package -g --no-progress
#   - cd com.unity.visualeffectgraph && upm-ci package pack
#   - cd com.unity.visualeffectgraph && upm-ci package test -u {{ editor.version }}
#   {% endfor %}
#   artifacts:
#     logs.zip:
#       paths:
#       - "**/upm-ci~/test-results/**/*"
#       - "**/upm-ci~/packages/**/*.tgz"
  
# pack_core:


# all_package_ci:
#   name: Pack and test all packages
#   agent:
#     type: Unity::VM::osx
#     image: buildfarm/mac:stable
#     flavor: m1.mac
#   commands:
#   - npm install upm-ci-utils@stable -g --registry https://api.bintray.com/npm/unity/unity-npm 
  
#   - cd com.unity.render-pipelines.core && upm-ci package pack
#   - cd com.unity.render-pipelines.core && upm-ci package test -u af24429dcc98

#   - cd com.unity.visualeffectgraph && upm-ci package pack
#   - cd com.unity.visualeffectgraph && upm-ci package test -u af24429dcc98

#   - cd com.unity.render-pipelines.core && upm-ci package pack
#   - cd com.unity.shadergraph && upm-ci package pack
#   - cd com.unity.shadergraph && upm-ci package test -u af24429dcc98

#   - cd com.unity.render-pipelines.core && upm-ci package pack
#   - cd com.unity.shadergraph && upm-ci package pack
#   - cd com.unity.render-pipelines.lightweight && upm-ci package pack
#   - cd com.unity.render-pipelines.lightweight && upm-ci package test -u af24429dcc98

#   - cd com.unity.render-pipelines.core && upm-ci package pack
#   - cd com.unity.shadergraph && upm-ci package pack
#   - cd com.unity.visualeffectgraph && upm-ci package pack
#   - cd com.unity.render-pipelines.high-definition && upm-ci package pack
#   - cd com.unity.render-pipelines.high-definition && upm-ci package test -u af24429dcc98

#   artifacts:
#     logs.zip:
#       paths:
#       - "**/upm-ci~/test-results/**/*"
#       - "**/upm-ci~/packages/**/*.tgz"


# publish:
#   name: Publish all packages
#   agent:
#     type: Unity::VM::osx
#     image: buildfarm/mac:stable
#     flavor: m1.mac
#   commands:
#   {% for project in projects %}
#   {% for editor in editors %}
#     - npm install upm-ci-utils -g --registry https://api.bintray.com/npm/unity/unity-npm
#     - cd {{ project.packagename }} && upm-ci package publish
#   {% endfor %}
#   {% endfor %}
# #  triggers:
# #    tags:
# #      only:
# #        - /^(r|R)(c|C)-\d+\.\d+\.\d+(-preview(\.\d+)?)?$/
# #        - /^(r|R)elease-\d+\.\d+\.\d+(-preview(\.\d+)?)?$/
#   artifacts:
#     artifacts.zip:
#       paths:
#         - "upm-ci~/packages/*.tgz"
#   dependencies:
#     - all_package_ci
    
